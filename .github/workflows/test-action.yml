# Copyright Kani Contributors
# SPDX-License-Identifier: Apache-2.0 OR MIT
name: Kani Action Check
on: pull_request

jobs:
  test-action:
    runs-on: ubuntu-latest
    name: Ensure that the Kani action continues to work
    steps:
      # To use this repository's private action,
      # you must check out the repository
      - name: Checkout
        uses: actions/checkout@v3

      - name: Run Kani with invalid version
        id: set_error
        run: |
          output=$(./src/install-kani.sh "0.47.0")
          echo "action_state=$output" >> $GITHUB_ENV
        continue-on-error: true  # Continue to the next steps even if this job fails

      - name: Check for Expected Error with invalid version
        id: check_error
        run: |
          printf '%s\n' "$action_state"

      - name: Run Kani with older version
        uses: ./ # Uses the action in the root directory
        with:
          working-directory: tests/cargo-kani/simple-lib
          kani-version: 0.33.0
      - name: Run Kani
        uses: ./ # Uses the action in the root directory
        with:
          working-directory: tests/cargo-kani/simple-lib
      - name: Test ProfProof within Kani Action
        uses: ./
        with:
          working-directory: tests/cargo-kani/proptest-lib
          args: --tests
          enable-propproof: true
